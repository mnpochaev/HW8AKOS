Для завершения работы клиента и сервера я сделал простой механизм через общую память и сигналы.

В общей структуре я храню PID сервера, PID клиента, число, флаг has_value и флаг terminate. Оба процесса ставят обработчики сигналов SIGINT и SIGTERM через signal(). В обработчике я просто ставлю глобальный флаг stop = 1, и из-за этого основной цикл прекращается.

Когда один из процессов завершается первым (например, я жму Ctrl+C в клиенте или сервере), он после выхода из цикла записывает в общую память terminate = 1 и отправляет сигнал второму процессу по его PID. Второй процесс тоже видит, что надо остановиться, выходит из цикла и завершается.

За удаление общей памяти отвечает сервер: после выхода из цикла он отключает сегмент от процесса и удаляет его. В итоге, если я завершаю любой из процессов, оба процесса останавливаются, и сегмент разделяемой памяти не остаётся висеть в системе.
